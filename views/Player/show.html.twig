{% extends 'layout.html.twig' %}

{% block title %}Players :: {{ player.username }}{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('includes/tipsy/src/stylesheets/tipsy.css') }}" />
{% endblock %}

{% block content %}
    <main class="s-player-profile">
        <section class="c-page__header">
            <div class="c-page__header__container">
                <section class="c-page__header__container__title">
                    {{ player.country.flagLiteral | raw }}
                    <h1>{{ player.username }}</h1>
                </section>
            </div>
        </section>

        <section class="o-layout c-public-profile">
            <section class="o-layout__sidebar c-public-profile__profile-picture">
                <img src="{{ player.avatar|imagine_filter('huge_thumb') }}">
            </section>

            <section class="o-layout__body--with-sidebar c-public-profile__details">
                <p>
                    {% if player.id == player.team.leader.id %}
                        <strong>Leader of</strong> {{ link_to(player.team) }}
                    {% else %}
                        <strong>Affiliated with</strong>
                        {% if player.team is valid %}
                            {{ link_to(player.team) }}
                        {% else %}
                            <em>no team.</em>
                        {% endif %}
                    {% endif %}
                </p>
                <p><strong>Joined on</strong> {{ player.joinedDate(constant("TimeDate::DATE_FULL")) }}</p>
                <p><strong>Last seen</strong> {{ player.lastLogin }}</p>

                {% if player.description is not empty %}
                    <section class="c-public-profile__details__bio s-markdown">
                        {{ player.description }}
                    </section>
                {% endif %}
            </section>
        </section>

        {% if me.hasPermission("view_visitor_log") %}
            <hr>

            <section class="o-layout">
                <section class="o-layout__body--half previous_callsigns">
                    <h4>
                        Previous Callsigns
                        <small>
                            [<a id="prev_callsigns" href="#" original-title="This is may not be the complete list. View more or add more.">?</a>]
                        </small>
                    </h4>

                    <ul>
                        {% for callsign in player.pastCallsigns %}
                            <li>{{ callsign }}</li>
                        {% endfor %}
                    </ul>
                </section>

                <section class="o-layout__body--half previous_ips">
                    <h4>
                        Known IP Addresses
                        <small>
                            [<a id="known_ips" href="#" original-title="This is may not be all of the IPs. View the complete list.">?</a>]
                        </small>
                    </h4>
                    <ul>
                        {% for address in player.knownIPs %}
                            <li>{{ address.ip }} - {{ address.host }}</li>
                        {% endfor %}
                    </ul>
                </section>
            </section>

            <section class="o-layout">
                <section class="o-layout__body--full admin_notes">
                    <h4>Admin Notes</h4>
                    {{ form_start(adminNotesForm) }}
                        {{ form_errors(adminNotesForm) }}

                        {{ form_row(adminNotesForm.notes, { label: false }) }}
                        {{ form_row(adminNotesForm.save, { attr: { class: "button grey notextshadow" }}) }}
                        {{ form_row(adminNotesForm.save_and_sign, { attr: { class: "button grey notextshadow" }}) }}
                    {{ form_end(adminNotesForm) }}
                </section>
            </section>
        {% endif %}
    </main>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('includes/chartjs/Chart.min.js') }}"></script>
    <script src="{{ asset('includes/tipsy/src/javascripts/jquery.tipsy.js') }}/"></script>
    <script>
        $("#prev_callsigns").tipsy({gravity: 's'});
        $("#known_ips").tipsy({gravity: 's'});
    </script>
{% endblock %}
